<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Calculator</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align to start to leave room for content below */
            min-height: 100vh;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 2.5em;
        }

        .calculator-container {
            background-color: #333;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            padding: 20px;
            width: 300px;
            max-width: 90%;
            margin-bottom: 30px;
        }

        .calculator-display {
            background-color: #222;
            color: #fff;
            font-size: 2.5em;
            padding: 20px;
            text-align: right;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            word-break: break-all; /* Allow breaking long numbers */
        }

        .calculator-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .calculator-buttons button {
            background-color: #555;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 20px 0;
            font-size: 1.5em;
            cursor: pointer;
            transition: background-color 0.2s;
            outline: none;
            user-select: none; /* Prevent text selection on button press */
        }

        .calculator-buttons button:hover {
            background-color: #777;
        }

        .calculator-buttons button:active {
            background-color: #999;
        }

        .calculator-buttons .operator {
            background-color: #f1a33c;
        }

        .calculator-buttons .operator:hover {
            background-color: #ffa000;
        }

        .calculator-buttons .clear {
            background-color: #d9534f;
            grid-column: span 1;
        }
        .calculator-buttons .clear:hover {
            background-color: #c9302c;
        }

        .calculator-buttons .equals {
            background-color: #28a745;
            grid-column: span 2;
        }

        .calculator-buttons .equals:hover {
            background-color: #218838;
        }

        .calculator-buttons .zero {
            grid-column: span 2;
        }

        .image-gallery {
            margin-top: 40px;
            text-align: center;
        }

        .image-gallery img {
            max-width: 500px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: block; /* Ensure it's a block element for margin: auto */
            margin: 0 auto; /* Center the image */
        }
    </style>
</head>
<body>
    <h1 id="gallery-title">Advanced Calculator & Image Gallery</h1>

    <div class="calculator-container">
        <div class="calculator">
            <div class="calculator-display" id="display">0</div>
            <div class="calculator-buttons">
                <button class="clear" id="clear">C</button>
                <button class="operator" data-operator="sqrt">âˆš</button>
                <button class="operator" data-operator="%">%</button>
                <button class="operator" data-operator="/">/</button>

                <button class="number">7</button>
                <button class="number">8</button>
                <button class="number">9</button>
                <button class="operator" data-operator="*">*</button>

                <button class="number">4</button>
                <button class="number">5</button>
                <button class="number">6</button>
                <button class="operator" data-operator="-">-</button>

                <button class="number">1</button>
                <button class="number">2</button>
                <button class="number">3</button>
                <button class="operator" data-operator="+">+</button>

                <button class="number zero">0</button>
                <button class="decimal">.</button>
                <button class="equals" data-operator="=">=</button>
            </div>
        </div>
    </div>

    <div class="image-gallery">
        <img src="https://media.istockphoto.com/id/1142291189/photo/plain-earth.jpg?s=612x612&w=0&k=20&c=7zAe9DY707KvrItshtdEVoptfRj6ksgbtjNx7Uzt1h0=" alt="Plain Earth">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const display = document.getElementById('display');
            const buttons = document.querySelector('.calculator-buttons');

            let displayValue = '0';
            let firstOperand = null;
            let operator = null;
            let waitingForSecondOperand = false;

            function updateDisplay() {
                // Limit display to prevent overflow, but allow more for calculations if needed
                if (displayValue.length > 15) {
                    display.textContent = parseFloat(displayValue).toPrecision(12);
                } else {
                    display.textContent = displayValue;
                }
            }

            function inputDigit(digit) {
                if (waitingForSecondOperand === true) {
                    displayValue = digit;
                    waitingForSecondOperand = false;
                } else {
                    // Prevent multiple leading zeros, unless it's a decimal number
                    displayValue = displayValue === '0' && digit !== '.' ? digit : displayValue + digit;
                }
                updateDisplay();
            }

            function inputDecimal(dot) {
                if (waitingForSecondOperand === true) {
                    displayValue = '0.';
                    waitingForSecondOperand = false;
                    updateDisplay();
                    return;
                }

                if (!displayValue.includes(dot)) {
                    displayValue += dot;
                }
                updateDisplay();
            }

            function performCalculation(first, op, second) {
                first = parseFloat(first);
                second = parseFloat(second);

                if (isNaN(first) || isNaN(second)) return;

                switch (op) {
                    case '+': return first + second;
                    case '-': return first - second;
                    case '*': return first * second;
                    case '/':
                        if (second === 0) {
                            alert('Cannot divide by zero!');
                            return 'Error';
                        }
                        return first / second;
                    default: return second;
                }
            }

            function handleOperator(nextOperator) {
                const inputValue = parseFloat(displayValue);

                if (operator && waitingForSecondOperand) {
                    operator = nextOperator; // Allow changing operator before second operand
                    return;
                }

                if (firstOperand === null && !isNaN(inputValue)) {
                    firstOperand = inputValue;
                } else if (operator) {
                    const result = performCalculation(firstOperand, operator, inputValue);
                    if (result === 'Error') {
                        displayValue = 'Error';
                        clearAll();
                        return;
                    }
                    displayValue = String(result);
                    firstOperand = result;
                }

                waitingForSecondOperand = true;
                operator = nextOperator;
                updateDisplay();
            }

            function clearAll() {
                displayValue = '0';
                firstOperand = null;
                operator = null;
                waitingForSecondOperand = false;
                updateDisplay();
            }

            function handleSpecialOperation(op) {
                let currentValue = parseFloat(displayValue);

                if (isNaN(currentValue)) return;

                switch (op) {
                    case 'sqrt':
                        if (currentValue < 0) {
                            displayValue = 'Error';
                            alert('Cannot take square root of a negative number!');
                            clearAll();
                        } else {
                            displayValue = String(Math.sqrt(currentValue));
                        }
                        break;
                    case '%':
                        if (operator && firstOperand !== null) {
                            // If an operator and firstOperand exist (e.g., 100 + 10%), calculate percentage of firstOperand
                            currentValue = (currentValue / 100) * firstOperand;
                            displayValue = String(currentValue);
                        } else {
                            // If no operator or firstOperand (e.g., 50%), just divide by 100
                            displayValue = String(currentValue / 100);
                        }
                        break;
                }
                updateDisplay();
            }

            buttons.addEventListener('click', (event) => {
                const { target } = event;

                if (!target.matches('button')) {
                    return;
                }

                if (target.classList.contains('number')) {
                    inputDigit(target.textContent);
                    return;
                }

                if (target.classList.contains('decimal')) {
                    inputDecimal(target.textContent);
                    return;
                }

                if (target.classList.contains('clear')) {
                    clearAll();
                    return;
                }

                if (target.classList.contains('operator')) {
                    const op = target.dataset.operator;
                    if (op === '=' && operator) {
                        handleOperator(op); // Perform final calculation
                        operator = null; // Clear operator after equals
                        waitingForSecondOperand = false; // Ready for new input
                        firstOperand = null; // Clear firstOperand after equals
                    } else if (op === 'sqrt' || op === '%') {
                        handleSpecialOperation(op);
                    } else if (op !== '=') {
                        handleOperator(op);
                    }
                    return;
                }
            });

            updateDisplay(); // Initialize display
        });
    </script>
</body>
</html>